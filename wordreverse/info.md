This thing is mostly 1 big code snippet that I edited a little
